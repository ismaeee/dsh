<!DOCTYPE html>

<html>

<head>
    <title>Simulacion Bolos</title>
    <script type="text/javascript" src="./libs/three.js"></script>
    <script type="text/javascript" src="./libs/jquery-1.9.0.js"></script>
    <script src="js/loaders/OBJLoader.js"></script>
    <script src="js/Keyboard.js"></script>
    

<!--
        <script src="js/loaders/DDSLoader.js"></script>
        <script src="js/loaders/MTLLoader.js"></script>
        <script src="js/loaders/OBJMTLLoader.js"></script>
-->

    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }

        body, section,div { margin:0px; padding:0px;}

        header{
                position: relative;
                color:black;
                height: 0px;
                padding-left: 30px; 

        }
        h1{
            margin-top: 0px;

            padding-top: 400px;
            padding-right: 30%;
            text-align: right;
            color:silver;
        }

        a{
            color:silver;
            text-decoration: none;
            padding: 10px 20px 10px 20px;
            background-color: black;
            font-weight: bolder;
            border-radius: 3px;
            font-size: 20px;
        }

        .enlace{
            padding-top: 30px;
        }

    #progressbar{
        background-color: green;
        width: 250px;
        height: 20px;
        margin-left:10px;
        position:absolute;
        z-index:100;
        display: inline-block;
        text-align: center;
        margin-top: -1px;
    }
    #xa{
        padding-left: 65%;

    }


    </style>
</head>
<body>

<!--


-->


<!-- Div which will hold the Output -->

<header>
    <div class="enlace"><a href="https://dsh2015-threejs.rhcloud.com/"> Volver </a></div>
    <div class="enlace"><a href="http://localhost:8000/Desktop/GitHub/three.js-master/examples/"> Reiniciar </a></div>

    <h1 id="Potencia"></h1>

</header>
<section>

        <div class="WebGL-output" id="contenedor"></div>

</section>
<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">

    
    // once everything is loaded, we run our Three.js stuff.
    var flag = false;
    var sphere;
    var scene;
    var potencia = 1;
    var empiezaTirar = false;
    var tirar = false;
    var resistencia = 0;
    var sonido = false;


    $(function () {


        var manager = new THREE.LoadingManager();
                manager.onProgress = function ( item, loaded, total ) {

                    console.log( item, loaded, total );

                };

                var texture = new THREE.Texture();

                var onProgress = function ( xhr ) {
                    if ( xhr.lengthComputable ) {
                        var percentComplete = xhr.loaded / xhr.total * 100;
                        console.log( Math.round(percentComplete, 2) + '% downloaded' );
                    }
                };

                var onError = function ( xhr ) {
                };


   



/*
 ----------------------------------------------------------------------------------------------------------- 
 -----------------------------------------------------------------------------------------------------------
         BOLOS            BOLOS            BOLOS            BOLOS            BOLOS            BOLOS     
 ----------------------------------------------------------------------------------------------------------- 
 -----------------------------------------------------------------------------------------------------------
 */

 var bloqueXbolos = -4;
 var bloqueZbolos = -10;
 var bloqueYbolos = 0;


/*
var bolo1 = new THREE.OBJMTLLoader();
    bolo1.load( 'obj/bowling/bolo.obj', 'obj/bowling/bolo.mtl', function ( object ) {

                    object.position.x = 0 + bloqueXbolos;//- 80;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -30 + bloqueZbolos;
                    scene.add( object );

                }, onProgress, onError );
*/







                // Bolo1


                var bolo1 = new THREE.OBJLoader( manager );
                bolo1.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );

                    object.position.x = 0 + bloqueXbolos;//- 80;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -30 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );




                //bolo2

                var bolo2 = new THREE.OBJLoader( manager );
                bolo2.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 6 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -30 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );


                //bolo3

                var bolo3 = new THREE.OBJLoader( manager );
                bolo3.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 12 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -30 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );

                //bolo4

                var bolo4 = new THREE.OBJLoader( manager );
                bolo4.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 18 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -30 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );

                //bolo5

                var bolo5 = new THREE.OBJLoader( manager );
                bolo5.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 3 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -26 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );
                
                var bolo6 = new THREE.OBJLoader( manager );
                bolo6.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 9 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -26 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );


                var bolo7 = new THREE.OBJLoader( manager );
                bolo7.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 15 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -26 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );
                
                var bolo8 = new THREE.OBJLoader( manager );
                bolo8.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 6 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -22 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );
                

                var bolo9 = new THREE.OBJLoader( manager );
                bolo9.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 12 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -22 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );

                var bolo10 = new THREE.OBJLoader( manager );
                bolo10.load( 'obj/bowling/bolo.obj', function ( object ) {

                    object.traverse( function ( child ) {

                        if ( child instanceof THREE.Mesh ) {child.material.map = texture;}

                    } );
                    object.position.x = 9 + bloqueXbolos;
                    object.position.y = 0 + bloqueYbolos;//- 80;
                    object.position.z = -18 + bloqueZbolos;
                    
                    scene.add( object );

                }, onProgress, onError );                
  

/*
 ----------------------------------------------------------------------------------------------------------- 
 -----------------------------------------------------------------------------------------------------------
         FIN BOLOS            FIN BOLOS            FIN BOLOS            FIN BOLOS            FIN BOLOS     
 ----------------------------------------------------------------------------------------------------------- 
 -----------------------------------------------------------------------------------------------------------
 */






        //var stats = initStats();

        // create a scene, that will hold all our elements such as objects, cameras and lights.
        scene = new THREE.Scene();

        // create a camera, which defines where we're looking at.
        var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);

        // create a render and set the size
        var renderer = new THREE.WebGLRenderer();

        renderer.setClearColor(new THREE.Color(0xEEEEEE, 1.0));
        renderer.setSize(window.innerWidth, window.innerHeight);

       

        var clock = new THREE.Clock();

        // create the ground plane
        var floortexture = new THREE.ImageUtils.loadTexture('fondoCarriles.jpg');
        var planeGeometry = new THREE.PlaneGeometry(110, 110, 1, 1);
        var planeMaterial = new THREE.MeshBasicMaterial({map: floortexture, side: THREE.Doubleside });
        var plane = new THREE.Mesh(planeGeometry, planeMaterial);


  
        // rotate and position the plane
        plane.rotation.x = -0.5 * Math.PI;
        plane.position.x = 0
        plane.position.y = 0
        plane.position.z = 0

        // add the plane to the scene
        scene.add(plane);


        
        //create fondo
        var cubeGeometry2 = new THREE.CubeGeometry(110, 30, 2);
        
        var fondoTexture = new THREE.ImageUtils.loadTexture('fondo.jpg');
        var fondoMaterial = new THREE.MeshBasicMaterial({map: fondoTexture });
        var fondo = new THREE.Mesh(cubeGeometry2.clone(), fondoMaterial);
        
        fondo.position.x = -40;
        fondo.position.y = 15;
        fondo.position.z = 0;
        fondo.rotation.y = Math.PI/90 * 45;
        scene.add(fondo);
        
        //create fondo2
        var cubeGeometry3 = new THREE.CubeGeometry(100, 30, 2);
        
        var fondoTexture = new THREE.ImageUtils.loadTexture('fondo3.jpg');
        var fondoMaterial = new THREE.MeshBasicMaterial({map: fondoTexture });
        var fondo2 = new THREE.Mesh(cubeGeometry3.clone(), fondoMaterial);
        
        fondo2.position.x = 0;
        fondo2.position.y = 15;
        fondo2.position.z = -55;
        //fondo.rotation.y = Math.PI/90 * 45;
        scene.add(fondo2);

//create sphere

         var bolitaTexture = new THREE.ImageUtils.loadTexture('capitanamericaF.jpg');
         var sphereGeometry = new THREE.SphereGeometry(3.5, 10, 10);
         var sphereMaterial = new THREE.MeshBasicMaterial({map: bolitaTexture});
         sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);

        // position the sphere
        sphere.position.x = 5;
        sphere.position.y = 4;
        sphere.position.z = 35;
        // add the sphere to the scene
        scene.add(sphere);

  



        // position and point the camera to the center of the scene
        camera.position.x = 55;
        camera.position.y = 30;
        camera.position.z = 40;
        camera.lookAt(scene.position);

        // add subtle ambient lighting
        var ambientLight = new THREE.AmbientLight(0x0c0c0c);
        scene.add(ambientLight);

        // add spotlight for the shadows
        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(90, 60, 10);

        scene.add(spotLight);

        // add the output of the renderer to the html element
        $(".WebGL-output").append(renderer.domElement);

        // call the render function
        var step = 0;
        var scalingStep = 0;

        var controls = new function () {
            this.rotationSpeed = 0.02;
            this.bouncingSpeed = 0.07;
            //this.scalingSpeed = 0.03;
        }

        //document.addEventListener( 'mousemove', playerPaddleMovement, false );

        render();

        function moverBola()
                        {

                            //  mueve bola Arriba
                            if (Key.isDown(Key.A))      
                            {
                                
                                if (sphere.position.x > -10 )
                                {
                                    console.log("Presionado A ");
                                    console.log(sphere.position.x);
                                    sphere.position.x -= ( 0.5);
                                }
                                
                            }   
                            // mueve bola Abajo
                            else if (Key.isDown(Key.D) )
                            {
                                if (sphere.position.x < 15)
                                {
                                    console.log("Presionado D ");
                                    console.log(sphere.position.x);
                                    sphere.position.x += ( 0.5);
                                }
                            }
                            else if (Key.isDown(Key.SPACE) && !tirar )
                            {
                                empiezaTirar = true;
 
                                if(potencia > 97){
                                    flag = true;
                                }else if(potencia <= 11){
                                    flag =false;
                                }

                                if(!flag){
                                    potencia += 2;
                                }else{
                                    potencia -= 2;
                                }

                                    
                                    console.log("Presionado SPACE ");
                                    $("#Potencia").text('Potencia: '+potencia);
                                
                            }
                            else if (!Key.isDown(Key.SPACE) && empiezaTirar){
                                tirar = true;
                            }



        }


        function render() {
            //var delta = clock.getDelta();
            moverBola();

            if(tirar){
                sphere.position.z -= potencia*0.02;
                sphere.rotation.x -= 0.004*potencia*Math.random();
                sphere.rotation.z -= 0.002*potencia*Math.random();
                /*
                //resistencia ... de momento na
                if( (sphere.position.z + ((resistencia+0.002)*1.001 )) > (sphere.position.z + (potencia/0.02))){
                    resistencia += 0.002;
                    resistencia *= 1.001;
                    sphere.position.z += resistencia;
                }
                 */

            }

            if (sphere.position.z <= -19 && !sonido){
                sonido = true;
                var snd = new Audio("bolos.mp3"); // buffers automatically when created
                snd.play();
            }

            // render using requestAnimationFrame
            renderer.render(scene, camera);
            requestAnimationFrame(render);

        }


    });


</script>
</body>
</html>